name: Apply Terragrunt stack
on:
  workflow_dispatch:
    inputs:
      working-directory:
        description: Path to terragrunt stack
jobs:
  apply-stack:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: hashicorp/setup-terraform@v2

      - uses: autero1/action-terragrunt@v1.1.0

      - uses: mdgreenwald/mozilla-sops-action@v1.4.0

      - shell: pwsh
        run: |
          Get-ChildItem -Filter *.enc.json -Recurse | %{ sops -d $_.FullName > $_.FullName -replace ".enc.json$", ".json" }
